<title>GoQR</title>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no;">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="format-detection" content="telephone=no">
<link rel="apple-touch-icon" href="misc/48.png">
<link rel="apple-touch-icon-precomposed" href="misc/48.png">
<link rel="apple-touch-startup-image" href="misc/startup.png">
<link rel="stylesheet" href="misc/jquery.mobile.css">
<script type="text/javascript" src="misc/jquery.js"></script>
<script type="text/javascript" src="misc/jquery.mobile.js"></script>

<div id="pagHome" data-role="page">
    <header data-role="header"><h1>GoQR</h1>
        <a href="#pagInfo" class="ui-btn-right" data-icon="info">关于</a>
    </header>
    <section data-role="content">
        <div id="tipCode">
            <a id="lnkCode" href="#pagCode" data-rel="dialog" data-transition="flip">
                <img id="imgCode" class="code">
            </a><p id="txtInfo"></p>
        </div>
        <form id="fomData" method="post" action="">
            <input placeholder="姓名" name="name" type="text" class="card">
            <input placeholder="电话" name="call" type="tel" class="card call msgs">
            <input placeholder="网址" name="http" type="url" class="http">
            <input placeholder="邮箱" name="mail" type="email" class="card mail">
            <textarea placeholder="文本" name="text" class="msgs mail text"></textarea>
            <button type="submit" data-role="button">生成</button>
        </form>
    </section>
    <footer data-role="footer">
        <nav id="barMenu" data-role="navbar"><ul>
            <li><a href="#" rel="card">名片</a></li>
    <!--	<li><a href="#" rel="call">电话</a></li>-->
            <li><a href="#" rel="msgs">短信</a></li>
            <li><a href="#" rel="http">网址</a></li>
            <li><a href="#" rel="mail">邮件</a></li>
            <li><a href="#" rel="text">文本</a></li>
        </ul></nav>
    </footer>
</div><!--pagHome-->


<div id="pagInfo" data-role="page">
    <header data-role="header"><h1>GoQR</h1></header>
    <section data-role="content">
    	<p>行动二维码生成器 GoQR 需要网络支持，移动版建议在手机处于 WiFi 或 WLAN 环境中时使用；</p>
        <p>由于不同扫描软件对于二维码所包含内容的解析支持并不相同，如果出现不能识别或识别不全，请尝试更换二维码扫描软件或通过以下地址反馈：</p>
        <p><center>==&gt; <a target="_blank" href="http://anyLiv.com/blog/1136#fomNote">问题反馈</a> &lt;==</center></p>
        <p>行动二维码生成器 GoQR 是基于 jQuery · jQueryMobile 及 Google Chart API 等优秀开源库构建，目前仅供测试。</p>
    </section>
</div><!--pagInfo-->


<div id="pagCode" data-role="dialog">
    <header data-role="header"><h1>GoQR</h1></header>
    <section data-role="content"><center>
        <p><img id="imgFull" class="code"></p>
        <p><b>Generated by GoQR</b></p>
    </center></section>
</div><!--pagCode-->


<style type="text/css" media="all">
body { }
form { }
header { }
footer { }
section { background-color:#F0F0F0; }

#tipCode { height:140px; }
#tipCode a,
#tipCode p { float:left; width:140px; }
#tipCode p { width:150px; overflow:hidden; margin:0; }

#imgCode { width:128px; height:128px; }
#imgFull { width:250px; height:250px; }

input.ui-input-text,
textarea.ui-input-text { width:99%; }

.portrait,
.portrait .ui-page { min-height:460px; }

</style>

<script type="text/javascript">jQuery(document).bind('mobileinit').ready(function($){
//

// tips info ...
var txtTip = new Array(
	'移动版的 GoQR 已经支持使用 iOS iPhone 的<b>添加桌面书签</b>功能',
	'想短信网页上的冷笑话给朋友？用 GoQR for Chrome 来生成文本二维码然后用手机扫描...',
	'目前 GoQR 已经免费提供 Chrome 版插件',
	'二维码成为链接物联网的桥梁',
	'不能识别时可尝试点击二维码图片放大'
);
$('#txtInfo').html('Tips:<br>' + txtTip[Math.floor(Math.random() * txtTip.length)]);
//document.write(test[Math.floor(Math.random()*test.length)]);
//setInterval("location.reload()",1000); 


// for navBar even...
var btnNav = $('#barMenu').find('a');
var fomDat = $('#fomData').children('input, textarea');
btnNav.click(function(){
	var zs = $(this);
	btnNav.removeClass('ui-btn-active');
	zs.addClass('ui-btn-active');
//	fomDat.hide().filter('.' + zs.attr('rel')).fadeIn('fast', function(){ $('#fomData').submit(); });
	fomDat.hide().filter('.' + zs.attr('rel')).fadeIn('fast');
//	$('img.code').removeAttr('src');
	$('img.code').attr('src', 'misc/code.png');
	return false;
}).eq(0).click();


// make the qrCode src ...
//alert(gChart('50x50', null));
function gChart(chs, chl){
	var src = 'http://chart.apis.google.com/chart?cht=qr&chld=|0&choe=UTF-8';
	src += '&chs=' + ( chs ? chs : '100x100' );
	src += '&chl=' + encodeURIComponent(chl);
	return chl ? src : false;
} // return qrCode src or false ...


$('#fomData').submit(function(){

	var msgNone = '';
	$('#fomData > input:visible').each(function(){
		var zs = $(this);
		msgNone += zs.val() ? '' : (zs.attr('placeholder') + ' ');
	});
//	alert(msgNone);
	if(msgNone && !confirm(msgNone + '为空\n是否继续？')){ return false; }

	var datBase = {
		name:$('input[name="name"]').val(),
		call:$('input[name="call"]').val(),
		mail:$('input[name="mail"]').val(),
		http:$('input[name="http"]').val(),
		text:$('textarea[name="text"]').val(),
		type:$('#barMenu').find('a.ui-btn-active').attr('rel')
	}
	switch(datBase.type){
		case 'card':
			var datCode = 'BEGIN:VCARD\nN:' + datBase.name + '\nTEL:' + datBase.call + '\nEMAIL:' + datBase.mail + '\nEND:VCARD'; 
			break;
		case 'msgs': var datCode = 'SMSTO:' + datBase.call + ':' + datBase.text; break;
		case 'call': var datCode = 'TEL:' + datBase.call; break;
		case 'mail': var datCode = 'MAILTO:' + datBase.mail + '?subject=' + '&body=' + datBase.text; break;
		case 'http': var datCode = 'URL:' + $('input[name="http"]').val(); break;
//		case 'text': var datCode = datBase.text; break;
		default: var datCode = datBase.text;
	}
	datCode ? $('img.code').attr('src', gChart('128x128', datCode)) : '';
//	$('#imgCode').attr('src', gChart('150x150', datCode));
//	$('#imgFull').attr('src', gChart('250x250', datCode));
	return false;
});
//$('#imgCode').click(function(){ $('#fomData').submit(); });


// reset section height ...
$('section').css('minHeight', $(window).height() - 110);


// for googleChrome
try{
	chrome.tabs.getSelected(null, function(tabs){
		$('input[name="http"]').val(tabs.url);
		$('textarea[name="text"]').val(tabs.title + ' ' + tabs.url);
		btnNav.eq(2).click();
		$('#fomData').submit();
	});
}catch(e){}

//
});</script>
